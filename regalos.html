<script>
  const params = new URLSearchParams(window.location.search);
  const email = params.get("email");
  let regaloSeleccionado = null;

  function cargarRegalos() {
    google.script.run
      .withSuccessHandler(renderRegalos)
      .withFailureHandler(err => {
        document.getElementById("regalos").innerText = "Error al cargar.";
        console.error(err);
      })
      .getRegalos();
  }

  function renderRegalos(lista) {
    const cont = document.getElementById("regalos");
    cont.innerHTML = "";

    lista.forEach(reg => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <img src="${reg.imagen}" alt="Regalo">
        <h3>${reg.nombre}</h3>
        <p>${reg.descripcion}</p>
      `;

      div.onclick = () => {
        document.querySelectorAll(".item").forEach(e => e.classList.remove("selected"));
        div.classList.add("selected");
        regaloSeleccionado = reg.id;   // <-- IMPORTANTE (ID REAL)
      };

      cont.appendChild(div);
    });
  }

  function enviarSeleccion() {
    if (!regaloSeleccionado) {
      alert("Por favor, elegÃ­ un regalo antes de enviar.");
      return;
    }

    google.script.run
      .withSuccessHandler(() => {
        window.location.href = "exit.html";
      })
      .guardarRespuesta(email, [regaloSeleccionado]);   // <-- ARRAY
  }

  cargarRegalos();
</script>
